:navtitle: User Guide
:description: Guide to using asclepias in projects
:lawvere-url: https://bartoszmilewski.com/2017/08/26/lawvere-theories/
:ghc: 8.10.7
:cabal: 3.6.2.0
:source-highlighter: highlightjs

= The `asclepias` User Guide 

The purpose of the user guide is to provide guidance on using `asclepias`.
This guide covers:

* How to get started using `asclepias`
* Background theory on `asclepias`
* Instructions for using `asclepias`
* References

== Getting Started
include::getting-started.adoc[leveloffset=+1]

== Background
#TODO flesh this out a bit#
The xref:theory:index.adoc[Theory and design] 
section contains background information on the event-data-model design.

== Instructions

=== 1. Define Model
include::model-procedures.adoc[leveloffset=+1]

=== 2. Set Up ETL Process
#TODO - what needs to be done here?#

=== 3. Initialize Project Repo
include::initialize-new-project.adoc[leveloffset=+1]

=== 4. Load Study Data
This is not an essential step, but I'm sure
user will want a way to peak at their data
and use it for testing.
#TODO how to?#

The `EventDataTheory.EventLines` module provides several utilities
for decoding events from eventlines.
The `parseEventLinesL` function, for example,
converts a `ByteString` of new-line delimed JSON
into a pair of `[String]` (containing any parse error messages)
and `[(SubjectID, Event t m a)]`, 
a list of Subject ID/event pairs.  

=== 5. Create Cohort Application
include::cohort-procedures.adoc[leveloffset=+1]


=== 6. Test Cohort Application
#TODO write this up#


=== 7. Run Cohort Application


== Examples
This section provides detailed examples of `asclepias` usage.

=== Features

This section provides examples of feature creation.

include::features:example$src/LastEventInWindow.adoc[leveloffset=+3]

include::features:example$src/DurationsWithMultipleConditions.adoc[leveloffset=+3]

include::features:example$src/HistoryOfEvent.adoc[leveloffset=+3]

include::features:example$src/TwoOutOneIn.adoc[leveloffset=+3]

include::features:example$src/CountOfHospitalEvents.adoc[leveloffset=+3]

include::features:example$src/DrugDiscontinuation.adoc[leveloffset=+3]

=== Cohorts
This section provides examples for defining cohorts.

include::cohorts:example$src/DefineIndexSet.adoc[leveloffset=+3]

include::cohorts:example$src/CreateAssessmentInterval.adoc[leveloffset=+3]

include::cohorts:example$src/Minimal.adoc[leveloffset=+3]

include::cohorts:example$src/CalendarCohort.adoc[leveloffset=+3]

==== Create a cohort with multiple indices

#TODO#

==== Collect attrition info across partitions

#TODO#

==== Create a cohort application and process in AWS batch

#TODO#

== Templates

=== Features
This section includes description and usage guides for
`Definition` templates.
A `Definiton` is a function that returns a `Feature`.

[#build-n-of-x-base]
include::features:example$templatesSrc/BuildNofXBase.adoc[leveloffset=+3]

[#build-n-of-x]
include::features:example$templatesSrc/BuildNofX.adoc[leveloffset=+3]

[#build-n-of-unique-begins]
include::features:example$templatesSrc/BuildNofUniqueBegins.adoc[leveloffset=+3]

[#build-n-of-with-gap]
include::features:example$templatesSrc/BuildNofXWithGap.adoc[leveloffset=+3]

[#build-n-of-x-or-m-of-y-with-gap]
include::features:example$templatesSrc/BuildNofXOrMofYWithGap.adoc[leveloffset=+3]

[#build-is-enrolled]
include::features:example$templatesSrc/BuildIsEnrolled.adoc[leveloffset=+3]

[#build-continuous-enrollment]
include::features:example$templatesSrc/BuildContinuousEnrollment.adoc[leveloffset=+3]

=== Cohorts
This section includes description and usage guides for cohort specification templates.

== References
include::references.adoc[leveloffset=+1]


